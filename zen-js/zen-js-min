function lines(e,t,n,a,o,r,c,i){var d=((c-o)*(t-r)-(i-r)*(e-o))/((i-r)*(n-e)-(c-o)*(a-t)),l=((n-e)*(t-r)-(a-t)*(e-o))/((i-r)*(n-e)-(c-o)*(a-t));return d>=0&&d<=1&&l>=0&&l<=1}function boxes([e,t,n,a],[o,r,c,i]){return e<o+c&&e+n>o&&t<r+i&&t+a>r}function lineBox(e,t,n,a,[o,r,c,i]){return lines(e,t,n,a,o,r,o,r+i)||lines(e,t,n,a,o+c,r,o+c,r+i)||lines(e,t,n,a,o,r,o+c,r)||lines(e,t,n,a,o,r+i,o+c,r+i+i)}function getGamepad(e){return controlon[e]?navigator.getGamepads()[e]:null}pointBox=((e,t,[n,a,o,r])=>n<=e&&e<=n+o&&a<=t&&t<=a+r),controlon=[!1,!1,!1,!1],window.addEventListener("gamepadconnected",function(e){controlon[e.gamepad.index]=!0}),window.addEventListener("gamepaddisconnected",function(e){controlon[e.gamepad.index]=!1});const b=document.body,c=document.getElementById("canv"),ctx=c.getContext("2d",{alpha:!1});function rungame(i){document.getElementById("load").hidden=!0;var file=i.files[0],read=new FileReader;read.readAsText(file),read.onload=(()=>{var code=read.result;eval(code),_frame=0;for(var li=load.length,_i=0;_i<li;_i++)load[_i]()})}function _setfont(){ctx.font=`${font_size}px ${font_family}`}function addLoad(e){load.push(e)}function addFrame(e){frame.push(e)}function getImage(e){var t=new Image;return t.src=`${imagepath}${e}.png`,loadedpercent[1]++,t.onload=(()=>{loadedpercent[0]++}),t}function set_fontfamily(e){font_family=e,_setfont()}function set_fontsize(e){font_size=e,_setfont()}function key(e){return null!=keys[e]&&keys[e]}function changedkey(e){return null!=changed[e]&&changed[e]}function justpressed(e){return key(e)&&changedkey(e)}function getMouse(){return{x:mx,y:my,down:mdown}}function gp_axes(e,t){var n=getGamepad(e);return null==n?0:n.axes[t]}function gp_button(e,t){var n=getGamepad(e);return null!=n&&n.buttons[t].pressed}function gp_vibrate(e,t,n,a){getGamepad(e).vibrationActuator.playEffect("dual-rumble",{duration:t,strongMagnitude:n,weakMagnitude:a})}function d_clear(e){var t=ctx.getTransform();ctx.resetTransform(),ctx.fillStyle=e,ctx.fillRect(0,0,c.width,c.height),ctx.setTransform(t)}function d_text(e,t,n,a){null!=a&&(ctx.fillStyle=a),ctx.fillText(e,t,n+font_size/1)}function d_rect(e,t,n,a,o){null!=o&&(ctx.fillStyle=o),ctx.fillRect(e,t,n,a)}function d_line(e,t,n,a,o){null!=o&&(ctx.strokeStyle=o),ctx.beginPath(),ctx.moveTo(e,t),ctx.lineTo(n,a),ctx.stroke()}function d_image(e,t,n,a,o){null==a?ctx.drawImage(e,t,n):ctx.drawImage(e,t,n,a,o)}function d_rotimage(e,t,n,a,o,r){var c=ctx.getTransform();ctx.translate(t,n),ctx.rotate(a),ctx.drawImage(e,-o,-r),ctx.setTransform(c)}function m_norm(e,t){var n=m_dist(e,t);return 0==n?[0,0]:[e/n,t/n]}function movecamera(e,t){_camera[0]+=e,_camera[1]+=t}function setcamera(e,t){_camera=[e-c.width/2,t-c.height/2]}function dragcamera(e,t,n){var a=[_camera[0]+c.width/2,_camera[1]+c.height/2],o=[e-a[0],t-a[1]];a=[a[0]+o[0]/n,a[1]+o[1]/n],_camera=[a[0]-c.width/2,a[1]-c.height/2]}function dragcameracenter(e){var t=[-_camera[0],-_camera[1]];_camera=[_camera[0]+t[0]/e,_camera[1]+t[1]/e]}function playAudio(e){var t=new Audio(e);t.oncanplay=(()=>{t.play()})}function ti_start(){_textinput="",_ti=!0}function ti_end(){_ti=!1}r=c.getBoundingClientRect(),mdown=!1,mx=0,my=0,b.onmousemove=(e=>{r=c.getBoundingClientRect();var t=r.width/c.width;mx=(e.x-r.x)/t,my=(e.y-r.y)/t}),b.onmousedown=(()=>{mdown=!0}),b.onmouseup=(()=>{mdown=!1}),changed={},keys={},b.onkeydown=(e=>{_ti&&("Backspace"==e.key?_textinput=_textinput.slice(0,_textinput.length-1):"Shift"!=e.key&&"Control"!=e.key&&(_textinput+=e.key)),changed[e.key]=!0,keys[e.key]=!0}),b.onkeyup=(e=>{changed[e.key]=!0,keys[e.key]=!1}),_frame=0,setInterval(()=>{_frame++;for(var e=frame.length,t=0;t<e;t++)ctx.resetTransform(),ctx.translate(-_camera[0],-_camera[1]),frame[t](_frame);changed={}},50/3),load=[],frame=[],loadedpercent=[0,0],imagepath="",font_family="sans-serif",font_size="10",gp_connected=(e=>controlon[e]),deadzone=((e,t)=>Math.abs(e)<t?0:e),m_radians=(e=>e*Math.PI/180),m_degrees=(e=>180*e/Math.PI),m_dist=((e,t)=>Math.sqrt(e*e+t*t)),m_average=(e=>e.reduce((e,t)=>e+t)/e.length),_camera=[0,0],getcamerashift=(()=>[c.width/2,c.height/2]),offCamera=((e,t)=>pointBox(e,t,[_camera[0],_camera[1],c.width,c.height])),pixelAt=((e,t)=>ctx.getImageData(e,t,1,1).data),_ti=!1,_textinput="",get_ti=(()=>_textinput);
